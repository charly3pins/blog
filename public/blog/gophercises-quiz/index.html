<!DOCTYPE html>
<html lang="en" data-theme="light">
	
	<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="referrer" content="no-referrer">
  <meta name="description" content="Engineering Director">

  <title>Gophercises - Quiz game | Charly3Pins</title>


  <meta property="og:title" content="Gophercises - Quiz game - charly3pins" />

  <meta property="og:type" content="website">
  <meta property="og:description" content="Code review of my first exercise in the Gophercises page. It&#39;s focused in the CSV and time packages in addition to an introduction for the goroutines and channels.">
  <meta property="og:url" content="https://charly3pins.dev/blog/gophercises-quiz/">
  <meta property="og:site_name" content="charly3pins.dev">
  
  <meta property="og:image" content="https://charly3pins.dev/images/go-learn.png">

  <meta name="twitter:card" content="summary_large_image">

  <meta name="twitter:title" content="Gophercises - Quiz game" />


  <meta name="twitter:description" content="Code review of my first exercise in the Gophercises page. It&#39;s focused in the CSV and time packages in addition to an introduction for the goroutines and channels.">


  <meta name="twitter:image" content="https://charly3pins.dev/images/go-learn.png">



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-126216319-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  <link rel="stylesheet" href="https://charly3pins.dev/css/main.css" />
  <link rel="stylesheet" href="https://charly3pins.dev/css/syntax.css" />
  <link rel="stylesheet" href="https://charly3pins.dev/css/social_share.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

	<body>
		<div class="navbar-container">
    <nav class="navbar-navigation">
        
        <a href="/">Home</a>
        
        <a href="/blog/">Blog</a>
        
        <a href="/code/">Code</a>
        
        <a href="/about/">About</a>
        
        
        <ul class="lang-selector">
            <li>
                <a>English</a> <i class="fa fa-angle-down" aria-hidden="true"></i>
                <ul>
                
                </ul>
            </li>
        </ul>
        
        <button class="theme-switch-wrapper">
            <img id="theme-switcher" class="theme-switcher" src="https://sunilsandhu.com/assets/icons/sun-moon.png" alt="toggle dark mode">
        </button>
    </nav>
</div>
		
		<div class="layout-container">

			<section class="blog-container">
				
				<h4 class="post-title">Gophercises - Quiz game</h4>
				<h2 class="post-description">Code review of my first exercise in the Gophercises page. It&#39;s focused in the CSV and time packages in addition to an introduction for the goroutines and channels.</h2>

				<div class="post-metadata">
					<div class="post-tags">
						
						<a class="tag" href="https://charly3pins.dev/tags/go/">#go</a>
						
					</div>
					<span class="post-date">
						24/09/2018 Â· 8 min read
					</span>
				</div>

				<ul class="icons">
    
    <li>
        
        <a href="//twitter.com/share?url=https%3a%2f%2fcharly3pins.dev%2fblog%2fgophercises-quiz%2f&amp;text=Gophercises%20-%20Quiz%20game&amp;via=charly3pins&amp;hashtags=go" target="_blank" class="share-btn twitter">
            <i class="fa fa-twitter"></i>
        </a>
    </li>

    
    <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcharly3pins.dev%2fblog%2fgophercises-quiz%2f" target="_blank" class="share-btn facebook">
            <i class="fa fa-facebook"></i>
        </a>
    </li>

    
    <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fcharly3pins.dev%2fblog%2fgophercises-quiz%2f&amp;title=Gophercises%20-%20Quiz%20game" target="_blank" class="share-btn reddit">
            <i class="fa fa-reddit-alien"></i>
        </a>
    </li>

    
    <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fcharly3pins.dev%2fblog%2fgophercises-quiz%2f&amp;title=Gophercises%20-%20Quiz%20game" target="_blank" class="share-btn linkedin">
            <i class="fa fa-linkedin"></i>
        </a>
    </li>

    
    <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fcharly3pins.dev%2fblog%2fgophercises-quiz%2f&amp;description=Gophercises%20-%20Quiz%20game" target="_blank" class="share-btn pinterest">
            <i class="fa fa-pinterest-p"></i>
        </a>
    </li>

    
    <li>
        <a href="mailto:?subject=Check out this post by charly3pins&amp;body=https%3a%2f%2fcharly3pins.dev%2fblog%2fgophercises-quiz%2f" target="_blank" class="share-btn email">
            <i class="fa fa-envelope"></i>
        </a>
    </li>
</ul>


				<article>
					
					<div class="centered">
						<img src="https://charly3pins.dev/images/go-learn.png" alt="cover image">
					</div>
					
					
					<div class="page-separator"></div>
					<p>This is the first of a several articles I&rsquo;m planning to write commenting the different exercises that I&rsquo;m doing in <a href="https://gophercises.com/">Gophercises</a> page.</p>
<blockquote>
<p>It&rsquo;s a FREE course that will help you become more familiar with Go while developing your skills as a programmer. In the course we will build roughly 20 different mini-applications, packages, and tools that are each designed to teach you something different.</p>
<p><!-- raw HTML omitted -->Gophercises<!-- raw HTML omitted --></p>
</blockquote>
<p>I like playing with Go on this site because each exercise is focused in a set of packages of the language and the way of they are presented is really clear and easy to understand. Also, the explanations in video are very helpful to see the final code once you&rsquo;ve yours done.</p>
<h1 id="quiz-game">Quiz game</h1>
<p><a href="https://gophercises.com/exercises/quiz">Exercise 1</a> is about creating a program that reads a quiz provided via CSV file, then give the quiz to a user keeping track of how many questions they get right and how many they get incorrect. Second part is about adding a timer to make the game more interesting to play ending the execution when the timer is expired. At the end of the quiz the program shall output the total number of questions correct and how many questions there were in total. Questions given invalid answers or unanswered are considered incorrect.</p>
<p>On the first part the most exciting task is to work with <code>encoding/csv</code> and <code>flag</code> packages. First one is obviously for work with the CSV file where we&rsquo;ll have our quiz stored. Second one implements command-line flag parsing which we&rsquo;ll use it for injecting the name of the file when we execute the program. What I always do in this cases is go to the <a href="https://golang.org/pkg/">official documentation</a> and check the <code>#pkg-index</code> anchor of the package that I&rsquo;m intereseted. There are a list of all methods and types that the package contains. Then the <code>#pkg-examples</code> one is very helpful to clarify sometimes the method usage.</p>
<h2 id="flag-parse">Flag parse</h2>
<p>First of all, we want to know the filename where is stored the quiz using flags. If we check the <a href="https://golang.org/pkg/flag/#pkg-index">flag package</a> we see that there are a lot of types supported, in this case we need the <a href="https://golang.org/pkg/flag/#String">String</a>. So, for obtaining the filename we&rsquo;ll need to use the method like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">filename</span> <span class="o">:=</span> <span class="nx">flag</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;csv&#34;</span><span class="p">,</span> <span class="s">&#34;problems.csv&#34;</span><span class="p">,</span> <span class="s">&#34;csv filename&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">flag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="process-csv">Process CSV</h2>
<p>Once we have the filename it&rsquo;s time to read it from the system. In my case I&rsquo;ve used the <code>os</code> package to open the file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="o">*</span><span class="nx">filename</span><span class="p">)</span>
</span></span></code></pre></div><p><!-- raw HTML omitted -->Note that I&rsquo;m using a pointer to filename because the String method returns a <code>*string</code>.<!-- raw HTML omitted --></p>
<p>Then it&rsquo;s time to use the <code>encoding/csv</code> package for reading the CSV.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">()</span>
</span></span></code></pre></div><p>With method <a href="https://golang.org/pkg/encoding/csv/#Reader.ReadAll">ReadAll</a> we obtain a <code>[][]string</code>, so we just need to loop over the slice obtained and parse it to the types we need. In the quiz game, we know that CSV file contains two strings, first one is the question and the second one is the answer. I&rsquo;ve created a custom type called <code>problem</code> with two strings for manipulate the rows of the file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">problem</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">question</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">answer</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Now it&rsquo;s time to convert each row read from the file to a <code>problem</code> struct. The easiest way is to loop over the map of rows and declare a slice of problems <code>[]problem</code> and initialize them with the values of the row that we are obtaining:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">parseCSV</span><span class="p">(</span><span class="nx">rows</span> <span class="p">[][]</span><span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="nx">problem</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">problems</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">problem</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">rows</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> 	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">row</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">rows</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">problems</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">problem</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">question</span><span class="p">:</span> <span class="nx">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">			<span class="nx">answer</span><span class="p">:</span>   <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 	<span class="k">return</span> <span class="nx">problems</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><!-- raw HTML omitted -->I&rsquo;ve initialized the problems var with the <code>len(rows)</code> because I knew the exact length and will not change during the execution. Being strict with the nomenclature, the type of our var problems is <code>[len(rows)]problem</code>. In Go when a slice have the length fixed is called array. You can read further on <a href="https://blog.golang.org/go-slices-usage-and-internals">this post</a>.<!-- raw HTML omitted --></p>
<p>Finally it only remains to display the questions on the screen and request the user for the answers. For achieve this I&rsquo;ve used the <a href="https://golang.org/pkg/fmt/#Scanf">fmt.Scanf()</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">problems</span> <span class="o">:=</span> <span class="nf">parseCSV</span><span class="p">(</span><span class="nx">rows</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">correct</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">problem</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">problems</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Problem #%d: %s = &#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">answer</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Scanf</span><span class="p">(</span><span class="s">&#34;%s\n&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">answer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">answer</span> <span class="o">==</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">answer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">correct</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d answers correct of %d questions.&#34;</span><span class="p">,</span> <span class="nx">correct</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">problems</span><span class="p">))</span>
</span></span></code></pre></div><p>Check the entire solution for this part on <a href="https://github.com/charly3pins/gophercises/commit/3a841b67c154fbbb7749eb61612989be8c1127a9#diff-eef4eb636e863480b77d87bc3000e0d1">this commit</a>.</p>
<h2 id="adding-timers">Adding timers</h2>
<p>On the second part we are asked to add a timer with a default value of 30s customizable via flags. We need to refactor the code to stop the execution when the time is expired.</p>
<p>On this part is introduced the <code>time</code> package used for measuring and displaying time. For do the task, we&rsquo;ll need to create a <a href="https://golang.org/pkg/time/#Timer">Timer</a>. The package provides <a href="https://golang.org/pkg/time/#NewTimer">NewTimer</a> method which need a <a href="https://golang.org/pkg/time/#Duration">Duration</a> as a parameter. Not casual the package provide a set of constants to convert time to nanosecond and then convert them to Duration. All togheter looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">timer</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">NewTimer</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="o">*</span><span class="nx">limit</span><span class="p">)</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span></code></pre></div><p><!-- raw HTML omitted --><code>*limit</code> is obtained via flag in same way we&rsquo;ve obtained the filename in the first section.<!-- raw HTML omitted --></p>
<p>At this point we have the timer created and if we analyze it we see that it contains a channel inside. Let&rsquo;s see what it&rsquo;s a channel first of all and why it&rsquo;s useful in this case.</p>
<blockquote>
<p>Channels are the pipes that connect concurrent goroutines. You can send values into channels from one goroutine and receive those values into another goroutine</p>
<p><!-- raw HTML omitted --><a href="https://gobyexample.com/channels">https://gobyexample.com/channels</a><!-- raw HTML omitted --></p>
</blockquote>
<p>You can send value to channel <code>ch &lt;- v</code> and you can receive from a channel and assign it to a var <code>v := &lt;-ch</code>. Sends and receives block until the other side is ready.</p>
<p>If you&rsquo;ve checked the documentation for Timer, you&rsquo;ll see that says:</p>
<blockquote>
<p>When the Timer expires, the current time will be sent on C</p>
<p><!-- raw HTML omitted --><a href="https://golang.org/pkg/time/#Timer">https://golang.org/pkg/time/#Timer</a><!-- raw HTML omitted --></p>
</blockquote>
<p>So this means that we can use the Timer&rsquo;s channel to know when the timer is expired just checking if it contains any value or not. For this we can use a <code>select</code> (switch in other languages) inside our <code>for</code> loop and checking it. If we&rsquo;re in this case, we&rsquo;ll need to stop the quiz so we&rsquo;ll need to print the final result:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;\n%d answers correct of %d questions.\n&#34;</span><span class="p">,</span> <span class="nx">correct</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">problems</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><!-- raw HTML omitted -->The <code>return</code> is because I want to break the loop and I don&rsquo;t want to use labels and gotos on this code.<!-- raw HTML omitted --></p>
<p>On the other hand, we need to cover the case when the timer is not expired, so we can add a <code>default</code> case printing the question and waiting for the answer. For achieve this, we just need to move our previous code inside the <code>select</code> block. The complete code for the loop:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">problem</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">problems</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Problem #%d: %s = &#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;\n%d answers correct of %d questions.\n&#34;</span><span class="p">,</span> <span class="nx">correct</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">problems</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">answer</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Scanf</span><span class="p">(</span><span class="s">&#34;%s\n&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">answer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">answer</span> <span class="o">==</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">answer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">correct</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>At this point you could think that we have the program finished but if you execute it you&rsquo;ll see what happens. Yes! the <code>fmt.Scanf(&quot;%s\n&quot;, &amp;answer)</code> is blocking and the program doesn&rsquo;t continues execution until the function receives a value. To solve this, we&rsquo;ll need to use a <code>goroutine</code> and move the blocking part inside. However, before that let&rsquo;s talk a bit about what are and how to integrate with our code.</p>
<blockquote>
<p>A goroutine is a lightweight thread managed by the Go runtime.</p>
<p><!-- raw HTML omitted --><a href="https://tour.golang.org/concurrency/1">https://tour.golang.org/concurrency/1</a><!-- raw HTML omitted --></p>
</blockquote>
<p>So in Go the threads are called <!-- raw HTML omitted -->goroutine<!-- raw HTML omitted --> and they are easy to recognise because they are calls to a function preceeded by the keyword <code>go</code>. Using the golang tour example below, we see the goroutine is executing the <code>say</code> function concurrently passing the parameter &ldquo;world&rdquo; and in main thread we have the exeuction of <code>say</code> with parameter &ldquo;hello&rdquo;.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">say</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="nf">say</span><span class="p">(</span><span class="s">&#34;world&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nf">say</span><span class="p">(</span><span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As we expected, the output of the program is not sequential and we obtain the 5x <code>hello world</code> sentences mixed.</p>
<pre tabindex="0"><code>world
hello
hello
world
world
hello
hello
world
world
hello
</code></pre><p>Knowing what is a channel and how to work with them and knowing the powerful of the goroutines, we can mix them to achieve our goal in this task. The channels allows goroutines to synchronize without explicit locks or condition variables between them. Let&rsquo;s do it!</p>
<p>First we move the question outside the <code>select</code> block and extract the <code>default</code> case in a goroutine like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Problem #%d: %s = &#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">answerChannel</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">answer</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">answer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">answerChannel</span> <span class="o">&lt;-</span> <span class="nx">answer</span>
</span></span><span class="line"><span class="cl"><span class="p">}()</span>
</span></span></code></pre></div><p><!-- raw HTML omitted -->As we read, we need a channel to talk between the goroutines (remember that the main thread is a goroutine in itself) so we have to create a new channel <code>answerChannel</code> and pass the user&rsquo;s response. <!-- raw HTML omitted --></p>
<p>Last but not least, we need to do is read the channel we&rsquo;ve created. For this I&rsquo;ve created a new <code>case</code> block:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;\n%d answers correct of %d questions.\n&#34;</span><span class="p">,</span> <span class="nx">correct</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">problems</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="nx">answer</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">answerChannel</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">answer</span> <span class="o">==</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">answer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">correct</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Now we have all done, checking on the first case the Timer&rsquo;s channel to know if the time is expired and the second case receiving the user&rsquo;s answer every time he types on the screen, but without blocking the execution because we&rsquo;ve moved this task to a <code>goroutine</code>.</p>
<p>The full code for the second part is available <a href="https://github.com/charly3pins/gophercises/commit/2b821d0a9821cd6de93985a963e2a24350b34b7b">here</a>.</p>
<h1 id="in-summary">In summary</h1>
<p>To sum up, I think this is a very good exercise to do because it introduces you a few useful packages like <code>encoding/csv</code> that I&rsquo;m sure you&rsquo;ll need to use sometimes. There a lot of information that is stored in <code>.csv</code> and it&rsquo;s always useful know how to deal with it. Also it&rsquo;s a good starting point for the <code>channels</code> and <code>goroutines</code> (probably I&rsquo;ll dedicate an entire post to them). Here you can see how to work with them together and why are useful in a real case.</p>
<p>You can check the <a href="https://github.com/charly3pins/gophercises/tree/master/quiz">complete repo</a> that I&rsquo;ve created for this exercise.</p>

				</article>

				
				
				
				<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-charly3pins-dev" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
			
			</section>
			
			<div class="page-separator centered"><hr></div>
			
			<footer class="footer-container">
	<ul class="footer-social-icons-container">
		<li><a class="footer-social-icon" href="https://twitter.com/charly3pins" target="_blank" aria-label="Twitter">
			<i class="fa fa-twitter fa-fw" title="Twitter"></i></a>
		</li>
		<li><a class="footer-social-icon" href="https://github.com/charly3pins" target="_blank" aria-label="GitHub">
			<i class="fa fa-github-alt fa-fw" title="GitHub"></i></a>
		</li>
		<li><a class="footer-social-icon" href="https://stackoverflow.com/users/4948631/charly3pins" target="_blank" aria-label="Stack Overflow">
			<i class="fa fa-stack-overflow fa-fw" title="Stack Overflow"></i></a>
		</li>
		<li><a class="footer-social-icon" href="https://charly3pins.dev/index.xml" target="_blank" aria-label="RSS">
			<i class="fa fa-rss fa-fw" title="RSS"></i></a>
		</li>
		<li><a class="footer-social-icon" href="https://dev.to/charly3pins" target="_blank" aria-label="Dev.to">
			<i class="fa fa-dev-to" title="Dev.to"></i>DEV</a>
		</li> 
		<li><a class="footer-social-icon" href="mailto:hello@charly3pins.dev" target="_blank" aria-label="Email">
			<i class="fa fa-envelope fa-fw" title="email"></i></a>
		</li>
	</ul>
	<div class="footer-text">Last post on 09/12/2021</div>
	<div class="footer-text">Â© 2018 - 2023 Charly3Pins</div>
</footer>
<script type="text/javascript" src="https://charly3pins.dev/js/theme-switcher.js"></script>

		
		</div>

	</body>
</html>
